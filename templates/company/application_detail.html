<!-- templates/company/application_detail.html -->
{% extends 'base.html' %}
{% load static %}

{% block title %}Application Details{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <nav class="col-md-2 d-md-block bg-light sidebar">
            {% include 'partials/sidebar_company.html' %}
        </nav>

        <main class="col-md-10 ms-sm-auto px-md-4">
            <div class="d-flex justify-content-between align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">Application Details</h1>
                <a href="{% url 'company_application_list' %}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Back to Applications
                </a>
            </div>

            <div class="row">
                <!-- Application Info -->
                <div class="col-md-8">
                    <div class="card shadow mb-4">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">Applicant Information</h5>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <strong>Name:</strong>
                                    <p>{{ application.applicant.jobseeker_profile.full_name }}</p>
                                </div>
                                <div class="col-md-6">
                                    <strong>Email:</strong>
                                    <p>{{ application.applicant.email }}</p>
                                </div>
                            </div>

                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <strong>Phone:</strong>
                                    <p>{{ application.applicant.jobseeker_profile.phone }}</p>
                                </div>
                                <div class="col-md-6">
                                    <strong>City:</strong>
                                    <p>{{ application.applicant.jobseeker_profile.city }}</p>
                                </div>
                            </div>

                            <div class="mb-3">
                                <strong>Applied For:</strong>
                                <p><a href="{% url 'job_detail' application.job.pk %}">{{ application.job.title }}</a></p>
                            </div>

                            <div class="mb-3">
                                <strong>Applied Date:</strong>
                                <p>{{ application.applied_date|date:"F d, Y - h:i A" }}</p>
                            </div>

                            <hr>

                            <div class="mb-3">
                                <strong>Cover Letter:</strong>
                                <div class="p-3 bg-light rounded">
                                    {{ application.cover_letter|linebreaks }}
                                </div>
                            </div>

                            <div class="mb-3">
                                <strong>Resume:</strong>
                                <div>
                                    <a href="{{ application.resume.url }}" target="_blank" class="btn btn-primary">
                                        <i class="fas fa-download"></i> Download Resume
                                    </a>
                                </div>
                            </div>

                            {% if application.notes %}
                            <hr>
                            <div class="mb-3">
                                <strong>Internal Notes:</strong>
                                <div class="p-3 bg-warning bg-opacity-10 rounded">
                                    {{ application.notes|linebreaks }}
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Applicant Profile -->
                    <div class="card shadow">
                        <div class="card-header">
                            <h5 class="mb-0">Applicant Profile</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <strong>Skills:</strong>
                                <p>{{ application.applicant.jobseeker_profile.skills|default:"Not provided" }}</p>
                            </div>
                            <div class="mb-3">
                                <strong>Education:</strong>
                                <p>{{ application.applicant.jobseeker_profile.education|default:"Not provided" }}</p>
                            </div>
                            <div class="mb-3">
                                <strong>Experience:</strong>
                                <p>{{ application.applicant.jobseeker_profile.experience|default:"Not provided" }}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Actions Sidebar -->
                <div class="col-md-4">
                    <div class="card shadow sticky-top" style="top: 20px;">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">Actions</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label class="form-label">Current Status:</label>
                                <span class="badge bg-{{ application.status|yesno:'success,warning,info' }} w-100 p-2">
                                    {{ application.get_status_display }}
                                </span>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Change Status:</label>
                                <select class="form-select status-select" 
                                        data-application-id="{{ application.pk }}"
                                        data-original-status="{{ application.status }}">
                                    <option value="submitted" {% if application.status == 'submitted' %}selected{% endif %}>Submitted</option>
                                    <option value="under_review" {% if application.status == 'under_review' %}selected{% endif %}>Under Review</option>
                                    <option value="shortlisted" {% if application.status == 'shortlisted' %}selected{% endif %}>Shortlisted</option>
                                    <option value="interview_scheduled" {% if application.status == 'interview_scheduled' %}selected{% endif %}>Interview Scheduled</option>
                                    <option value="accepted" {% if application.status == 'accepted' %}selected{% endif %}>Accepted</option>
                                    <option value="rejected" {% if application.status == 'rejected' %}selected{% endif %}>Rejected</option>
                                </select>
                            </div>

                            <hr>

                            <div class="d-grid gap-2">
                                <button onclick="addApplicationNote({{ application.pk }})" class="btn btn-warning">
                                    <i class="fas fa-sticky-note"></i> Add Note
                                </button>
                                <a href="mailto:{{ application.applicant.email }}" class="btn btn-info">
                                    <i class="fas fa-envelope"></i> Email Applicant
                                </a>
                                <a href="{{ application.resume.url }}" download class="btn btn-success">
                                    <i class="fas fa-download"></i> Download Resume
                                </a>
                            </div>

                            <hr>

                            <div class="text-center">
                                <small class="text-muted">
                                    Last Updated: {{ application.updated_date|date:"M d, Y" }}
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>
{% endblock %}

